# CI/CD Pipeline ä½¿ç”¨æŒ‡å—å’Œå·¥ä½œåŸç†è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [å·¥ä½œæµç¨‹æ¦‚è¿°](#å·¥ä½œæµç¨‹æ¦‚è¿°)
3. [è¯¦ç»†é…ç½®è§£è¯»](#è¯¦ç»†é…ç½®è§£è¯»)
4. [å·¥ä½œåŸç†æ·±åº¦åˆ†æ](#å·¥ä½œåŸç†æ·±åº¦åˆ†æ)
5. [YAML ç¼–å†™è§„åˆ™å’Œæœ€ä½³å®è·µ](#yaml-ç¼–å†™è§„åˆ™å’Œæœ€ä½³å®è·µ)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šæ¨é€ä»£ç åˆ° main åˆ†æ”¯

```bash
cd /home/hugo/projects/TEST/pet-clinic-project
git add .
git commit -m "Add GitHub Actions CI/CD workflow"
git push origin main
```

ä¸€æ—¦ä»£ç è¢«æ¨é€åˆ° `main` åˆ†æ”¯ï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ£€æµ‹åˆ° `.github/workflows/ci-build.yml` æ–‡ä»¶ï¼Œå¹¶è§¦å‘å·¥ä½œæµç¨‹ã€‚

### ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹å·¥ä½œæµç¨‹æ‰§è¡Œç»“æœ

1. æ‰“å¼€ä½ çš„ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡» **"Actions"** é€‰é¡¹å¡
3. ä½ ä¼šçœ‹åˆ°æœ€æ–°çš„å·¥ä½œæµç¨‹æ‰§è¡Œè®°å½•
4. ç‚¹å‡»å…·ä½“çš„ workflow run æ¥æŸ¥çœ‹è¯¦ç»†çš„æ„å»ºæ—¥å¿—

### ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥æ„å»ºçŠ¶æ€

- âœ… **ç»¿è‰²å¯¹å‹¾**ï¼šæ„å»ºæˆåŠŸ
- âŒ **çº¢è‰²å‰å·**ï¼šæ„å»ºå¤±è´¥ï¼Œç‚¹å‡»æŸ¥çœ‹é”™è¯¯æ—¥å¿—

---

## å·¥ä½œæµç¨‹æ¦‚è¿°

### è§¦å‘æ¡ä»¶ï¼ˆTriggerï¼‰

```yaml
on:
  push:
    branches:
      - main
```

**å«ä¹‰ï¼š** å½“ä»£ç è¢«æ¨é€åˆ° `main` åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨è§¦å‘å·¥ä½œæµç¨‹ã€‚

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼š**
- ç¡®ä¿æ¯æ¬¡ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯æ—¶éƒ½ä¼šè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»º
- é˜²æ­¢æœ‰é—®é¢˜çš„ä»£ç è¢«éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## è¯¦ç»†é…ç½®è§£è¯»

### å®Œæ•´çš„ `ci-build.yml` æ–‡ä»¶ç»“æ„

```
â”œâ”€ name: CI Build                                    # å·¥ä½œæµç¨‹åç§°
â”œâ”€ on: push to main                                 # è§¦å‘æ¡ä»¶
â”œâ”€ jobs:                                            # å®šä¹‰æ‰€æœ‰çš„å·¥ä½œ
â”‚  â”œâ”€ build-backend:                               # åç«¯æ„å»ºä»»åŠ¡
â”‚  â”‚  â”œâ”€ runs-on: ubuntu-latest                    # è¿è¡Œç¯å¢ƒ
â”‚  â”‚  â””â”€ steps:                                    # æ‰§è¡Œæ­¥éª¤
â”‚  â”‚     â”œâ”€ Checkout code                          # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
â”‚  â”‚     â”œâ”€ Set up JDK 21                          # æ­¥éª¤2ï¼šå®‰è£…Javaç¯å¢ƒ
â”‚  â”‚     â”œâ”€ Cache Maven dependencies                # æ­¥éª¤3ï¼šç¼“å­˜ä¾èµ–
â”‚  â”‚     â””â”€ Build backend with Maven               # æ­¥éª¤4ï¼šæ‰§è¡Œæ„å»º
â”‚  â”‚
â”‚  â””â”€ build-frontend:                              # å‰ç«¯æ„å»ºä»»åŠ¡
â”‚     â”œâ”€ runs-on: ubuntu-latest                    # è¿è¡Œç¯å¢ƒ
â”‚     â””â”€ steps:                                    # æ‰§è¡Œæ­¥éª¤
â”‚        â”œâ”€ Checkout code                          # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
â”‚        â”œâ”€ Set up Node.js 20.x                    # æ­¥éª¤2ï¼šå®‰è£…Node.js
â”‚        â”œâ”€ Cache NPM dependencies                  # æ­¥éª¤3ï¼šç¼“å­˜ä¾èµ–
â”‚        â”œâ”€ Install dependencies                   # æ­¥éª¤4ï¼šå®‰è£…npmåŒ…
â”‚        â””â”€ Build frontend                         # æ­¥éª¤5ï¼šæ‰§è¡Œæ„å»º
```

### åç«¯æ„å»ºä»»åŠ¡è¯¦è§£ï¼ˆbuild-backendï¼‰

#### 1. **æ£€å‡ºä»£ç **
```yaml
- name: Checkout code
  uses: actions/checkout@v4
```
- **ä½œç”¨**ï¼šä» GitHub ä»“åº“å…‹éš†æœ€æ–°ä»£ç åˆ° CI/CD ç¯å¢ƒ
- **ä¸ºä»€ä¹ˆå¿…é¡»**ï¼šGitHub Actions éœ€è¦è·å–ä½ çš„æºä»£ç æ‰èƒ½è¿›è¡Œæ„å»º

#### 2. **è®¾ç½® Java ç¯å¢ƒ**
```yaml
- name: Set up JDK 21
  uses: actions/setup-java@v4
  with:
    java-version: '21'
    distribution: 'temurin'
```
- **ä½œç”¨**ï¼šåœ¨ Ubuntu è™šæ‹Ÿæœºä¸Šå®‰è£… Java 21 SDK
- **å‚æ•°è¯´æ˜**ï¼š
  - `java-version: '21'` - æŒ‡å®š Java ç‰ˆæœ¬ä¸º 21ï¼ˆä¸é¡¹ç›® pom.xml ä¸€è‡´ï¼‰
  - `distribution: 'temurin'` - ä½¿ç”¨ Eclipse Temurin ä½œä¸º JDK å‘è¡Œç‰ˆ
- **ä¸ºä»€ä¹ˆè¿™æ ·é€‰æ‹©**ï¼špet-clinic-backend çš„ pom.xml è¦æ±‚ Java 21ï¼ŒTemurin æ˜¯ç¨³å®šçš„å¼€æº JDK å‘è¡Œç‰ˆ

#### 3. **ç¼“å­˜ Maven ä¾èµ–**
```yaml
- name: Cache Maven dependencies
  uses: actions/cache@v4
  with:
    path: ~/.m2/repository
    key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
    restore-keys: |
      ${{ runner.os }}-maven-
```
- **ä½œç”¨**ï¼šå°† Maven ä¸‹è½½çš„ä¾èµ–ç¼“å­˜åœ¨ GitHub Actions çš„ç¼“å­˜å­˜å‚¨ä¸­
- **å‚æ•°è¯¦è§£**ï¼š
  - `path: ~/.m2/repository` - Maven ä¾èµ–çš„æœ¬åœ°å­˜å‚¨ä½ç½®
  - `key` - ç¼“å­˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆåŸºäºæ“ä½œç³»ç»Ÿå’Œ pom.xml å†…å®¹å“ˆå¸Œï¼‰
  - å¦‚æœ pom.xml æ²¡æœ‰æ”¹å˜ï¼Œä¼šå¤ç”¨ä¸Šæ¬¡çš„ç¼“å­˜ï¼Œå¤§å¤§åŠ å¿«æ„å»ºé€Ÿåº¦
- **æ€§èƒ½æå‡**ï¼š
  - é¦–æ¬¡æ„å»ºï¼šä¸‹è½½æ‰€æœ‰ä¾èµ–ï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰
  - åç»­æ„å»ºï¼šä½¿ç”¨ç¼“å­˜çš„ä¾èµ–ï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰

#### 4. **æ‰§è¡Œ Maven æ„å»º**
```yaml
- name: Build backend with Maven
  run: mvn -B package --file petclinic-backend/pom.xml
```
- **å‘½ä»¤è¯´æ˜**ï¼š
  - `mvn` - Maven å‘½ä»¤
  - `-B` - Batch modeï¼ˆæ‰¹å¤„ç†æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºäº¤äº’å¼æç¤ºï¼‰
  - `package` - Maven ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼ŒåŒ…æ‹¬ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…
  - `--file petclinic-backend/pom.xml` - æŒ‡å®š pom.xml æ–‡ä»¶ä½ç½®
- **æ‰§è¡Œè¿‡ç¨‹**ï¼š
  1. ç¼–è¯‘ Java æºä»£ç 
  2. è¿è¡Œå•å…ƒæµ‹è¯•
  3. ç”Ÿæˆ JAR åŒ…
  4. ä¿å­˜åˆ° `petclinic-backend/target/` ç›®å½•

### å‰ç«¯æ„å»ºä»»åŠ¡è¯¦è§£ï¼ˆbuild-frontendï¼‰

#### 1. **æ£€å‡ºä»£ç **
```yaml
- name: Checkout code
  uses: actions/checkout@v4
```
- åŒåç«¯ï¼Œè·å–æœ€æ–°çš„æºä»£ç 

#### 2. **è®¾ç½® Node.js ç¯å¢ƒ**
```yaml
- name: Set up Node.js 20.x
  uses: actions/setup-node@v4
  with:
    node-version: '20.x'
```
- **ä½œç”¨**ï¼šå®‰è£… Node.js 20.x è¿è¡Œç¯å¢ƒå’Œ npm
- **ä¸ºä»€ä¹ˆé€‰æ‹© 20.x**ï¼š
  - ä¸ package.json å…¼å®¹æ€§æœ€å¥½
  - æ˜¯ LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ï¼Œç¨³å®šå¯é 

#### 3. **ç¼“å­˜ NPM ä¾èµ–**
```yaml
- name: Cache NPM dependencies
  uses: actions/cache@v4
  with:
    path: petclinic-frontend/node_modules
    key: ${{ runner.os }}-npm-${{ hashFiles('petclinic-frontend/package-lock.json') }}
    restore-keys: |
      ${{ runner.os }}-npm-
```
- **ä½œç”¨**ï¼šç¼“å­˜ node_modules ç›®å½•ï¼Œé¿å…é‡å¤ä¸‹è½½
- **ç¼“å­˜ key**ï¼šåŸºäº package-lock.json çš„å“ˆå¸Œå€¼
- **ä¼˜åŠ¿**ï¼šnpm åŒ…å¾ˆå¤šæ—¶ç¼“å­˜æ•ˆæœæ˜¾è‘—

#### 4. **å®‰è£…ä¾èµ–**
```yaml
- name: Install dependencies
  run: npm install
  working-directory: petclinic-frontend
```
- **`working-directory`**ï¼šæŒ‡å®šåœ¨ petclinic-frontend ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤
- **ä½œç”¨**ï¼šå®‰è£… package.json ä¸­å®šä¹‰çš„æ‰€æœ‰ä¾èµ–åŒ…

#### 5. **æ„å»ºå‰ç«¯åº”ç”¨**
```yaml
- name: Build frontend
  run: npm run build
  working-directory: petclinic-frontend
```
- **ä½œç”¨**ï¼šæ‰§è¡Œ package.json ä¸­å®šä¹‰çš„ build è„šæœ¬
- **æ„å»ºè¿‡ç¨‹**ï¼š
  - Vite æ‰“åŒ…æºä»£ç 
  - ç”Ÿæˆä¼˜åŒ–åçš„ç”Ÿäº§èµ„æº
  - è¾“å‡ºåˆ° `dist/` ç›®å½•

---

## å·¥ä½œåŸç†æ·±åº¦åˆ†æ

### æ‰§è¡Œæµç¨‹æ—¶é—´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æ¨é€ä»£ç åˆ° main åˆ†æ”¯                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        GitHub Actions æ£€æµ‹åˆ° push äº‹ä»¶å’Œ ci-build.yml          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
         â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯æ„å»ºä»»åŠ¡å¼€å§‹      â”‚   â”‚  å‰ç«¯æ„å»ºä»»åŠ¡å¼€å§‹      â”‚
â”‚  build-backend      â”‚   â”‚  build-frontend     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ å¹¶è¡Œæ‰§è¡Œ                  â”‚ å¹¶è¡Œæ‰§è¡Œ
       â”‚                          â”‚
       â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€å‡ºä»£ç            â”‚   â”‚ 1. æ£€å‡ºä»£ç            â”‚
â”‚ 2. å®‰è£… JDK 21       â”‚   â”‚ 2. å®‰è£… Node.js 20   â”‚
â”‚ 3. ç¼“å­˜/æ¢å¤ä¾èµ–      â”‚   â”‚ 3. ç¼“å­˜/æ¢å¤ä¾èµ–      â”‚
â”‚ 4. ç¼–è¯‘æµ‹è¯•æ‰“åŒ…       â”‚   â”‚ 4. å®‰è£… npm åŒ…       â”‚
â”‚    (mvn package)    â”‚   â”‚ 5. æ„å»ºå‰ç«¯          â”‚
â”‚                     â”‚   â”‚    (vite build)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â–¼                          â–¼
  âœ… ç”Ÿæˆ JAR           âœ… ç”Ÿæˆ dist/
       â”‚                          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        âœ… å·¥ä½œæµç¨‹å®Œæˆï¼ˆå…¨éƒ¨æˆåŠŸï¼‰
           æˆ–
        âŒ å·¥ä½œæµç¨‹å¤±è´¥ï¼ˆä»»ä¸€ä»»åŠ¡å¤±è´¥ï¼‰
```

### å…³é”®ç‰¹æ€§ï¼šå¹¶è¡Œæ‰§è¡Œï¼ˆParallel Executionï¼‰

**åç«¯å’Œå‰ç«¯ä»»åŠ¡åŒæ—¶è¿è¡Œï¼š**
- åç«¯å¯èƒ½éœ€è¦ 3-5 åˆ†é’Ÿ
- å‰ç«¯å¯èƒ½éœ€è¦ 2-3 åˆ†é’Ÿ
- **æ€»è€—æ—¶** = è¾ƒé•¿çš„é‚£ä¸ªä»»åŠ¡ï¼ˆçº¦ 5 åˆ†é’Ÿï¼‰
- è€Œä¸æ˜¯ 3 + 2 = 5 åˆ†é’Ÿçš„ä¸²è¡Œæ‰§è¡Œ

è¿™å¤§å¤§æé«˜äº† CI/CD çš„æ•ˆç‡ï¼

---

## YAML ç¼–å†™è§„åˆ™å’Œæœ€ä½³å®è·µ

### 1. **YAML åŸºæœ¬è¯­æ³•è§„åˆ™**

#### âœ… æ­£ç¡®ç¤ºä¾‹
```yaml
name: CI Build                    # é”®å€¼å¯¹ç”¨å†’å·åˆ†éš”
on:                               # é”®ååè·Ÿå†’å·
  push:                           # åµŒå¥—ä½¿ç”¨ç¼©è¿›ï¼ˆ2æˆ–4ä¸ªç©ºæ ¼ï¼‰
    branches:                     # ä¿æŒä¸€è‡´çš„ç¼©è¿›
      - main                      # åˆ—è¡¨é¡¹ç”¨ - å¼€å¤´
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```yaml
name: CI Build
on:                               # âŒ ç¼©è¿›ä¸ä¸€è‡´
 push:                            # âŒ æ··ç”¨ä¸åŒæ•°é‡çš„ç©ºæ ¼
    branches:                     # âŒ æ›´å¤šä¸è§„èŒƒçš„ç¼©è¿›
      - main
```

### 2. **jobs çš„è®¾è®¡åŸåˆ™**

```yaml
jobs:
  build-backend:                  # ä»»åŠ¡IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    runs-on: ubuntu-latest        # è¿è¡Œç¯å¢ƒ
    steps:                        # æ­¥éª¤åˆ—è¡¨
      - name: Step description    # æ­¥éª¤åç§°ï¼ˆå¯é€‰ä½†æ¨èï¼‰
        uses: action@version      # GitHub Action å¼•ç”¨
        # æˆ–
        run: command              # ç›´æ¥è¿è¡Œå‘½ä»¤
```

**è®¾è®¡åŸåˆ™ï¼š**
- æ¯ä¸ª job åº”è¯¥æœ‰æ¸…æ™°çš„èŒè´£ï¼ˆåç«¯ã€å‰ç«¯ã€æµ‹è¯•ç­‰ï¼‰
- ä½¿ç”¨ `runs-on: ubuntu-latest` ç¡®ä¿å…¼å®¹æ€§
- ä½¿ç”¨æœ‰æ„ä¹‰çš„ job ID å’Œ step names

### 3. **ç¼“å­˜ç­–ç•¥**

```yaml
- uses: actions/cache@v4
  with:
    path: ~/.m2/repository                    # ç¼“å­˜è·¯å¾„
    key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
    restore-keys: |                           # å›é€€é”®ï¼ˆé¡ºåºé‡è¦ï¼‰
      ${{ runner.os }}-maven-
```

**ç¼“å­˜é”®åŒ¹é…é€»è¾‘ï¼š**
1. é¦–å…ˆå°è¯•å®Œå…¨åŒ¹é… `key`
2. å¦‚æœæ²¡æœ‰ï¼ŒæŒ‰é¡ºåºå°è¯• `restore-keys`
3. å¦‚æœéƒ½æ²¡æœ‰åŒ¹é…ï¼Œåˆ›å»ºæ–°ç¼“å­˜

**æœ€ä½³å®è·µï¼š**
- ä½¿ç”¨ `hashFiles()` æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆ hash
- å½“ä¾èµ–é…ç½®æ–‡ä»¶ï¼ˆpom.xmlã€package.jsonï¼‰æ”¹å˜æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°ç¼“å­˜
- æä¾›å¤šä¸ª restore-keys ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ

### 4. **ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡**

```yaml
key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
     â†“                      â†“
   ä¸Šä¸‹æ–‡å˜é‡           å†…ç½®å‡½æ•°
```

**å¸¸ç”¨çš„ä¸Šä¸‹æ–‡å˜é‡ï¼š**
- `${{ runner.os }}` - æ“ä½œç³»ç»Ÿï¼ˆLinuxã€Windowsã€macOSï¼‰
- `${{ github.ref }}` - Git åˆ†æ”¯å¼•ç”¨
- `${{ github.sha }}` - æäº¤çš„ SHA å“ˆå¸Œå€¼

**å¸¸ç”¨çš„å†…ç½®å‡½æ•°ï¼š**
- `hashFiles('path')` - è®¡ç®—æ–‡ä»¶å†…å®¹çš„ hash
- `contains(string, substring)` - å­—ç¬¦ä¸²åŒ…å«åˆ¤æ–­

### 5. **Action ç‰ˆæœ¬é€‰æ‹©**

```yaml
uses: actions/checkout@v4          # âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šä¸»ç‰ˆæœ¬
uses: actions/checkout@main        # âŒ ä¸æ¨èï¼šå¯èƒ½å˜åŠ¨
uses: actions/checkout@v4.0.0      # âš ï¸ å¯é€‰ï¼šé”å®šå…·ä½“ç‰ˆæœ¬
```

**å»ºè®®ï¼š**
- ä½¿ç”¨ `@v4` è¿™æ ·çš„ä¸»ç‰ˆæœ¬å·
- è¿™æ ·èƒ½è·å¾—å‘åå…¼å®¹çš„è¡¥ä¸æ›´æ–°
- é¿å…ä¸å…¼å®¹çš„é‡å¤§ç‰ˆæœ¬å˜æ›´å¯¼è‡´çš„é—®é¢˜

### 6. **é”™è¯¯å¤„ç†å’Œæ¡ä»¶**

```yaml
- name: Build
  run: mvn -B package
  if: success()                     # ä»…åœ¨å‰ç½®æ­¥éª¤æˆåŠŸæ—¶æ‰§è¡Œ
  continue-on-error: false          # æ­¤æ­¥éª¤å¤±è´¥æ—¶åœæ­¢å·¥ä½œæµ

- name: Upload artifacts
  if: always()                      # æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ
```

**å¸¸ç”¨æ¡ä»¶ï¼š**
- `if: success()` - å‰ç½®æ­¥éª¤éƒ½æˆåŠŸ
- `if: failure()` - å‰ç½®æ­¥éª¤æœ‰å¤±è´¥
- `if: always()` - æ€»æ˜¯æ‰§è¡Œ
- `if: contains(github.ref, 'main')` - æ¡ä»¶åˆ¤æ–­

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šMaven æ„å»ºå¤±è´¥ âŒ

**ç—‡çŠ¶ï¼š** `BUILD FAILURE` é”™è¯¯

**æ£€æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. åœ¨æœ¬åœ°å°è¯•æ„å»º
cd petclinic-backend
mvn -B package

# 2. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
mvn -X -B package    # -X å¼€å¯è°ƒè¯•æ¨¡å¼

# 3. æ¸…é™¤æœ¬åœ°ç¼“å­˜åé‡è¯•
mvn clean package
```

**å¸¸è§åŸå› ï¼š**
- Java ç‰ˆæœ¬ä¸åŒ¹é…ï¼ˆæ£€æŸ¥ pom.xml ä¸­çš„ `<java.version>`)
- ä¾èµ–æ— æ³•ä¸‹è½½ï¼ˆç½‘ç»œé—®é¢˜æˆ–ä»“åº“é…ç½®ï¼‰
- æµ‹è¯•å¤±è´¥ï¼ˆè¿è¡Œ `mvn test` æŸ¥çœ‹å…·ä½“å¤±è´¥ï¼‰

### é—®é¢˜2ï¼šNPM å®‰è£…å¤±è´¥ âŒ

**ç—‡çŠ¶ï¼š** `npm ERR!` é”™è¯¯

**æ£€æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. åœ¨æœ¬åœ°å°è¯•å®‰è£…
cd petclinic-frontend
npm install

# 2. æ¸…é™¤ç¼“å­˜
npm cache clean --force
npm install

# 3. æ£€æŸ¥ Node ç‰ˆæœ¬
node --version
npm --version
```

**å¸¸è§åŸå› ï¼š**
- Node.js ç‰ˆæœ¬ä¸å…¼å®¹
- package-lock.json æŸå
- ä¾èµ–ç‰ˆæœ¬å†²çª

### é—®é¢˜3ï¼šç¼“å­˜å‘½ä¸­ç‡ä½ ğŸ”„

**ç—‡çŠ¶ï¼š** æ¯æ¬¡æ„å»ºéƒ½å¾ˆæ…¢

**è§£å†³æ–¹æ¡ˆï¼š**
```yaml
# æ£€æŸ¥ç¼“å­˜é”®çš„ç”Ÿæˆ
key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}

# ç¡®ä¿ pom.xml è·¯å¾„æ­£ç¡®
# ç¡®ä¿ hashFiles() èƒ½æ‰¾åˆ°æ–‡ä»¶
```

**ä¼˜åŒ–å»ºè®®ï¼š**
- éªŒè¯ `hashFiles()` èƒ½åŒ¹é…åˆ°æ­£ç¡®çš„é…ç½®æ–‡ä»¶
- æ£€æŸ¥ GitHub Actions çš„ Caches é€‰é¡¹å¡çœ‹ç¼“å­˜å¤§å°
- å¦‚æœç¼“å­˜è¿‡å¤§ï¼ˆ>5GBï¼‰ï¼Œå¯èƒ½è¢«è‡ªåŠ¨æ¸…é™¤

### é—®é¢˜4ï¼šå·¥ä½œæµç¨‹æ²¡æœ‰è§¦å‘ â¸ï¸

**ç—‡çŠ¶ï¼š** æ¨é€ä»£ç åï¼ŒActions æ ‡ç­¾é¡µæ²¡æœ‰æ–°çš„è¿è¡Œ

**æ£€æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. ç¡®è®¤æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
ls -la .github/workflows/ci-build.yml

# 2. æ£€æŸ¥ YAML è¯­æ³•
# åœ¨çº¿å·¥å…·ï¼šhttps://www.yamllint.com/

# 3. ç¡®è®¤è§¦å‘æ¡ä»¶
# ci-build.yml ä¸­çš„ branches: [main] ä¸å½“å‰åˆ†æ”¯ä¸€è‡´

# 4. æ£€æŸ¥æ¨é€æ˜¯å¦æˆåŠŸ
git log --oneline -5    # æŸ¥çœ‹æœ€è¿‘çš„æäº¤
```

**å¸¸è§åŸå› ï¼š**
- YAML æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼ˆActions ä¼šç›´æ¥å¿½ç•¥ï¼‰
- æ¨é€çš„åˆ†æ”¯ä¸æ˜¯ main
- æ–‡ä»¶æ²¡æœ‰æ­£ç¡®æäº¤åˆ° GitHub

---

## ç›‘æ§å’Œä¼˜åŒ–å»ºè®®

### ğŸ“Š æ€§èƒ½ç›‘æ§

åœ¨ GitHub ä»“åº“çš„ "Actions" æ ‡ç­¾é¡µï¼Œä½ å¯ä»¥ï¼š
1. æŸ¥çœ‹æ¯ä¸ªå·¥ä½œæµç¨‹çš„æ‰§è¡Œæ—¶é—´
2. æŸ¥çœ‹å“ªä¸ªæ­¥éª¤è€—æ—¶æœ€é•¿
3. æŸ¥çœ‹ç¼“å­˜çš„å‘½ä¸­ç‡

### âš¡ ä¼˜åŒ–æŠ€å·§

```yaml
# 1. å¹¶è¡Œæ‰§è¡Œç›¸å…³ä»»åŠ¡
jobs:
  backend:
    runs-on: ubuntu-latest
  frontend:
    runs-on: ubuntu-latest
  # è¿™ä¸¤ä¸ªä»»åŠ¡ä¼šåŒæ—¶è¿è¡Œ

# 2. ä½¿ç”¨æ›´å°çš„å®¹å™¨é•œåƒ
runs-on: ubuntu-latest    # âœ… æ ‡å‡† Ubuntu
runs-on: ubuntu-22.04     # âœ… æŒ‡å®šå…·ä½“ç‰ˆæœ¬å¯èƒ½æ›´å¿«

# 3. åªåœ¨å¿…è¦æ—¶æ‰è¿è¡Œ
if: contains(github.event.head_commit.message, '[ci]')

# 4. ä½¿ç”¨çŸ©é˜µç­–ç•¥æµ‹è¯•å¤šä¸ªé…ç½®
strategy:
  matrix:
    java-version: [17, 21]
```

---

## æ€»ç»“

### âœ… è¿™ä¸ª ci-build.yml ä¸ºä»€ä¹ˆèƒ½å®Œæˆ CI/CD ä»»åŠ¡ï¼Ÿ

1. **è‡ªåŠ¨åŒ–ï¼š** æ— éœ€æ‰‹åŠ¨è¿è¡Œæ„å»ºï¼Œæ¯æ¬¡ push è‡ªåŠ¨æ‰§è¡Œ
2. **å¹¶è¡Œæ€§ï¼š** åç«¯å’Œå‰ç«¯åŒæ—¶æ„å»ºï¼Œæé«˜æ•ˆç‡
3. **ä¾èµ–ç¼“å­˜ï¼š** åŠ å¿«æ„å»ºé€Ÿåº¦ï¼Œé™ä½å¤–ç½‘ä¾èµ–
4. **æ ‡å‡†åŒ–ï¼š** æ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„é…ç½®ï¼Œé¿å…"æˆ‘çš„æœºå™¨ä¸Šå¯ä»¥"é—®é¢˜
5. **å¯è§æ€§ï¼š** GitHub Actions ç•Œé¢æ¸…æ™°å±•ç¤ºæ„å»ºè¿‡ç¨‹å’Œç»“æœ
6. **å¯é æ€§ï¼š** æ„å»ºå¤±è´¥æ—¶è‡ªåŠ¨é€šçŸ¥ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. æ¨é€è¿™ä¸ªæ–‡ä»¶åˆ° GitHub
2. è¿›å…¥ Actions æ ‡ç­¾é¡µè§‚å¯Ÿæ„å»ºè¿‡ç¨‹
3. æ ¹æ®æ„å»ºç»“æœä¼˜åŒ–é…ç½®
4. è€ƒè™‘æ·»åŠ æµ‹è¯•ã€éƒ¨ç½²ç­‰æ›´å¤š steps
